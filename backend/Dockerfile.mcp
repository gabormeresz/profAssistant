# ============================================================================
# MCP Wikipedia Server Dockerfile
# ============================================================================
# Runs the wikipedia-mcp server as a standalone service via SSE transport.
# ============================================================================

FROM python:3.12-slim

# Pin uv to a specific version for reproducible builds.
# Bump manually when upgrading: https://github.com/astral-sh/uv/releases
COPY --from=ghcr.io/astral-sh/uv:0.10.0 /uv /uvx /bin/

WORKDIR /app

# Copy dependency files
COPY pyproject.toml uv.lock ./

# Install dependencies (wikipedia-mcp is in the project deps)
RUN uv sync --frozen --no-dev --no-install-project

# Copy source (needed for the project to be installable)
COPY . .
RUN uv sync --frozen --no-dev

# Create a non-root user
RUN addgroup --system app && adduser --system --ingroup app app

ENV PATH="/app/.venv/bin:$PATH"
ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1

EXPOSE 8765

# Switch to non-root user
USER app

CMD ["wikipedia-mcp", "--transport", "sse", "--port", "8765", "--host", "0.0.0.0"]
